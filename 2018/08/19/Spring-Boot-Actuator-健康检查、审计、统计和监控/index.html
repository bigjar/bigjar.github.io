<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Spring Boot Actuator:健康检查、审计、统计和监控"><meta name="keywords" content="Spring Boot,Actuator"><meta name="author" content="MrHook"><meta name="copyright" content="MrHook"><title>Spring Boot Actuator:健康检查、审计、统计和监控 | MrHook的时光机</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建一个有Actuator的Spring-Boot工程"><span class="toc-number">1.</span> <span class="toc-text">创建一个有Actuator的Spring Boot工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#增加Spring-Boot-Actuator到一个存在的应用"><span class="toc-number">2.</span> <span class="toc-text">增加Spring Boot Actuator到一个存在的应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用Actuator-Endpoints来监控应用"><span class="toc-number">3.</span> <span class="toc-text">使用Actuator Endpoints来监控应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#打开和关闭Actuator-Endpoints"><span class="toc-number">4.</span> <span class="toc-text">打开和关闭Actuator Endpoints</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#暴露Actuator-Endpoints"><span class="toc-number">5.</span> <span class="toc-text">暴露Actuator Endpoints</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解析常用的actuator-endpoint"><span class="toc-number">6.</span> <span class="toc-text">解析常用的actuator endpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#health-endpoint"><span class="toc-number">6.1.</span> <span class="toc-text">&#x2F;health endpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#显示详细的健康信息"><span class="toc-number">6.1.1.</span> <span class="toc-text">显示详细的健康信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建一个自定义的健康指标"><span class="toc-number">6.1.2.</span> <span class="toc-text">创建一个自定义的健康指标</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#metrics-endpoint"><span class="toc-number">6.2.</span> <span class="toc-text">&#x2F;metrics endpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loggers-endpoint"><span class="toc-number">6.3.</span> <span class="toc-text">&#x2F;loggers endpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#在运行时改变日志等级"><span class="toc-number">6.3.1.</span> <span class="toc-text">在运行时改变日志等级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#info-endpoint"><span class="toc-number">6.4.</span> <span class="toc-text">&#x2F;info endpoint</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用Spring-Security来保证Actuator-Endpoints安全"><span class="toc-number">7.</span> <span class="toc-text">使用Spring Security来保证Actuator Endpoints安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更多学习资源"><span class="toc-number">8.</span> <span class="toc-text">更多学习资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#翻译源"><span class="toc-number">9.</span> <span class="toc-text">翻译源</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">MrHook</div><div class="author-info__description text-center">stay hungry, stay foolish</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">37</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">28</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">6</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">MrHook的时光机</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Spring Boot Actuator:健康检查、审计、统计和监控</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-08-19</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>Spring Boot Actuator可以帮助你监控和管理Spring Boot应用，比如健康检查、审计、统计和HTTP追踪等。所有的这些特性可以通过JMX或者HTTP endpoints来获得。</p>
<p>Actuator同时还可以与外部应用监控系统整合，比如 <a href="https://prometheus.io/" target="_blank" rel="noopener">Prometheus</a>, <a href="https://graphiteapp.org/" target="_blank" rel="noopener">Graphite</a>, <a href="https://www.datadoghq.com/" target="_blank" rel="noopener">DataDog</a>, <a href="https://www.influxdata.com/" target="_blank" rel="noopener">Influx</a>, <a href="https://www.wavefront.com/" target="_blank" rel="noopener">Wavefront</a>, <a href="https://newrelic.com/" target="_blank" rel="noopener">New Relic</a>等。这些系统提供了非常好的仪表盘、图标、分析和告警等功能，使得你可以通过统一的接口轻松的监控和管理你的应用。</p>
<p>Actuator使用<a href="http://micrometer.io/" target="_blank" rel="noopener">Micrometer</a>来整合上面提到的外部应用监控系统。这使得只要通过非常小的配置就可以集成任何应用监控系统。</p>
<p>我将把Spring Boot Actuator教程分为两部分：</p>
<ul>
<li>第一部分(本文)教你如何配置Actuator和通过Http endpoints来进入这些特征。</li>
<li>第二部分教你如何整合Actuator和外部应用监控系统。</li>
</ul>
<h2 id="创建一个有Actuator的Spring-Boot工程"><a href="#创建一个有Actuator的Spring-Boot工程" class="headerlink" title="创建一个有Actuator的Spring Boot工程"></a>创建一个有Actuator的Spring Boot工程</h2><p>首先让我们建一个依赖acutator的简单应用。</p>
<p>你可以使用<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#getting-started-installing-the-cli" target="_blank" rel="noopener">Spring Boot CLI</a>创建应用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring init -d=web,actuator -n=actuator actuator</span><br></pre></td></tr></table></figure>

<p>或者，你可以使用<a href="http://start.spring.io/" target="_blank" rel="noopener">Spring Initializr</a>网站来创建应用：</p>
<p>![Spring initializr](Spring initialzr.png)</p>
<h2 id="增加Spring-Boot-Actuator到一个存在的应用"><a href="#增加Spring-Boot-Actuator到一个存在的应用" class="headerlink" title="增加Spring Boot Actuator到一个存在的应用"></a>增加Spring Boot Actuator到一个存在的应用</h2><p>你可以增加<code>spring-boot-actuator</code>模块到一个已经存在的应用，通过使用下面的依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于Gradle，依赖如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	compile(<span class="string">"org.springframework.boot:spring-boot-starter-actuator"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用Actuator-Endpoints来监控应用"><a href="#使用Actuator-Endpoints来监控应用" class="headerlink" title="使用Actuator Endpoints来监控应用"></a>使用Actuator Endpoints来监控应用</h2><p>Actuator创建了所谓的<strong>endpoint</strong>来暴露HTTP或者JMX来监控和管理应用。</p>
<p>举个例子，有一个叫<code>/health</code>的endpoint，提供了关于应用健康的基础信息。<code>/metrics</code>endpoints展示了几个有用的度量信息，比如JVM内存使用情况、系统CPU使用情况、打开的文件等等。<code>/loggers</code>endpoint展示了应用的日志和可以让你在运行时改变日志等级。</p>
<p><strong>值得注意的是，每一给actuator endpoint可以被显式的打开和关闭。此外，这些endpoints也需要通过HTTP或者JMX暴露出来，使得它们能被远程进入。</strong></p>
<p>让我们运行应用并且尝试进入默认通过HTTP暴露的打开状态的actuator endpoints。之后，我们将学习如何打开更多的endpoints并且通过HTTP暴露它们。</p>
<p>在应用的根目录下打开命令行工具运行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>

<p>应用默认使用<code>8080</code>端口运行。一旦这个应用启动了，你可以通过<a href="http://localhost:8080/actuator" target="_blank" rel="noopener">http://localhost:8080/actuator</a>来展示所有通过HTTP暴露的endpoints。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"_links"</span>:&#123;<span class="attr">"self"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"health"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/health"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"info"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/info"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>打开<a href="http://localhost:8080/actuator/health" target="_blank" rel="noopener">http://localhost:8080/actuator/health</a>，则会显示如下内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;status&quot;:&quot;UP&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>状态将是<code>UP</code>只要应用是健康的。如果应用不健康将会显示<code>DOWN</code>,比如与仪表盘的连接异常或者缺水磁盘空间等。下一节我们将学习spring boot如何决定应用的健康和如何修复这些健康问题。</p>
<p><code>info</code>endpoint(<a href="http://localhost:8080/actuator/info" target="_blank" rel="noopener">http://localhost:8080/actuator/info</a>)展示了关于应用的一般信息，这些信息从编译文件比如<code>META-INF/build-info.properties</code>或者Git文件比如<code>git.properties</code>或者任何环境的property中获取。你将在下一节中学习如何改变这个endpoint的输出。</p>
<p><strong>默认，只有<code>health</code>和<code>info</code>通过HTTP暴露了出来</strong>。这也是为什么<code>/actuator</code>页面只展示了<code>health</code>和<code>info</code>endpoints。我们将学习如何暴露其他的endpoint。首先，让我们看看其他的endpoints是什么。</p>
<p>以下是一些非常有用的actuator endpoints列表。你可以在<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html" target="_blank" rel="noopener">official documentation</a>上面看到完整的列表。</p>
<table>
<thead>
<tr>
<th>Endpoint ID</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>auditevents</td>
<td>显示应用暴露的审计事件 (比如认证进入、订单失败)</td>
</tr>
<tr>
<td>info</td>
<td>显示应用的基本信息</td>
</tr>
<tr>
<td>health</td>
<td>显示应用的健康状态</td>
</tr>
<tr>
<td>metrics</td>
<td>显示应用多样的度量信息</td>
</tr>
<tr>
<td>loggers</td>
<td>显示和修改配置的loggers</td>
</tr>
<tr>
<td>logfile</td>
<td>返回log file中的内容(如果logging.file或者logging.path被设置)</td>
</tr>
<tr>
<td>httptrace</td>
<td>显示HTTP足迹，最近100个HTTP request/repsponse</td>
</tr>
<tr>
<td>env</td>
<td>显示当前的环境特性</td>
</tr>
<tr>
<td>flyway</td>
<td>显示数据库迁移路径的详细信息</td>
</tr>
<tr>
<td>liquidbase</td>
<td>显示Liquibase 数据库迁移的纤细信息</td>
</tr>
<tr>
<td>shutdown</td>
<td>让你逐步关闭应用</td>
</tr>
<tr>
<td>mappings</td>
<td>显示所有的@RequestMapping路径</td>
</tr>
<tr>
<td>scheduledtasks</td>
<td>显示应用中的调度任务</td>
</tr>
<tr>
<td>threaddump</td>
<td>执行一个线程dump</td>
</tr>
<tr>
<td>heapdump</td>
<td>返回一个GZip压缩的JVM堆dump</td>
</tr>
</tbody></table>
<h2 id="打开和关闭Actuator-Endpoints"><a href="#打开和关闭Actuator-Endpoints" class="headerlink" title="打开和关闭Actuator Endpoints"></a>打开和关闭Actuator Endpoints</h2><p>默认，上述所有的endpints都是打开的，除了<code>shutdown</code> endpoint。</p>
<p>你可以通过设置<code>management.endpoint.&lt;id&gt;.enabled to true or false</code>(<code>id</code>是endpoint的id)来决定打开还是关闭一个actuator endpoint。</p>
<p>举个例子，要想打开<code>shutdown</code> endpoint，增加以下内容在你的<code>application.properties</code>文件中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.endpoint.shutdown.enabled=true</span><br></pre></td></tr></table></figure>



<h2 id="暴露Actuator-Endpoints"><a href="#暴露Actuator-Endpoints" class="headerlink" title="暴露Actuator Endpoints"></a>暴露Actuator Endpoints</h2><p>默认，素偶偶的actuator endpoint通过JMX被暴露，而通过HTTP暴露的只有<code>health</code>和<code>info</code>。</p>
<p>以下是你可以通过应用的properties可以通过HTTP和JMX暴露的actuator endpoint。</p>
<ul>
<li><p>通过HTTP暴露Actuator endpoints。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Use "*" to expose all endpoints, or a comma-separated list to expose selected ones</span><br><span class="line">management.endpoints.web.exposure.include=health,info </span><br><span class="line">management.endpoints.web.exposure.exclude=</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过JMX暴露Actuator endpoints。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Use "*" to expose all endpoints, or a comma-separated list to expose selected ones</span><br><span class="line">management.endpoints.jmx.exposure.include=*</span><br><span class="line">management.endpoints.jmx.exposure.exclude=</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>通过设置<code>management.endpoints.web.exposure.include</code>为<code>*</code>，我们可以在<a href="http://localhost:8080/actuator" target="_blank" rel="noopener">http://localhost:8080/actuator</a>页面看到如下内容。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"_links"</span>:&#123;<span class="attr">"self"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"auditevents"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/auditevents"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"beans"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/beans"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"health"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/health"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"conditions"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/conditions"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"configprops"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/configprops"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"env"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/env"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"env-toMatch"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/env/&#123;toMatch&#125;"</span>,<span class="attr">"templated"</span>:<span class="literal">true</span>&#125;,<span class="attr">"info"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/info"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"loggers"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/loggers"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"loggers-name"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/loggers/&#123;name&#125;"</span>,<span class="attr">"templated"</span>:<span class="literal">true</span>&#125;,<span class="attr">"heapdump"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/heapdump"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"threaddump"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/threaddump"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"prometheus"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/prometheus"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"metrics-requiredMetricName"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/metrics/&#123;requiredMetricName&#125;"</span>,<span class="attr">"templated"</span>:<span class="literal">true</span>&#125;,<span class="attr">"metrics"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/metrics"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"scheduledtasks"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/scheduledtasks"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"httptrace"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/httptrace"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;,<span class="attr">"mappings"</span>:&#123;<span class="attr">"href"</span>:<span class="string">"http://localhost:8080/actuator/mappings"</span>,<span class="attr">"templated"</span>:<span class="literal">false</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解析常用的actuator-endpoint"><a href="#解析常用的actuator-endpoint" class="headerlink" title="解析常用的actuator endpoint"></a>解析常用的actuator endpoint</h2><h3 id="health-endpoint"><a href="#health-endpoint" class="headerlink" title="/health endpoint"></a>/health endpoint</h3><p><code>health</code> endpoint通过合并几个健康指数检查应用的健康情况。</p>
<p>Spring Boot Actuator有几个预定义的健康指标比如<a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/jdbc/DataSourceHealthIndicator.html" target="_blank" rel="noopener"><code>DataSourceHealthIndicator</code></a>, <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.html" target="_blank" rel="noopener"><code>DiskSpaceHealthIndicator</code></a>, <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/mongo/MongoHealthIndicator.html" target="_blank" rel="noopener"><code>MongoHealthIndicator</code></a>, <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/redis/RedisHealthIndicator.html" target="_blank" rel="noopener"><code>RedisHealthIndicator</code></a>, <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/cassandra/CassandraHealthIndicator.html" target="_blank" rel="noopener"><code>CassandraHealthIndicator</code></a>等。它使用这些健康指标作为健康检查的一部分。</p>
<p>举个例子，如果你的应用使用<code>Redis</code>，<code>RedisHealthindicator</code>将被当作检查的一部分。如果使用<code>MongoDB</code>，那么<code>MongoHealthIndicator</code>将被当作检查的一部分。</p>
<p>你也可以关闭特定的健康检查指标，比如在prpperties中使用如下命令：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.health.mongo.enabled=false</span><br></pre></td></tr></table></figure>

<p>默认，所有的这些健康指标被当作健康检查的一部分。</p>
<h4 id="显示详细的健康信息"><a href="#显示详细的健康信息" class="headerlink" title="显示详细的健康信息"></a>显示详细的健康信息</h4><p><code>health</code> endpoint只展示了简单的<code>UP</code>和<code>DOWN</code>状态。为了获得健康检查中所有指标的详细信息，你可以通过在<code>application.yaml</code>中增加如下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">management:</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: always</span><br></pre></td></tr></table></figure>

<p>一旦你打开上述开关，你在<code>/health</code>中可以看到如下详细内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"status"</span>:<span class="string">"UP"</span>,<span class="attr">"details"</span>:&#123;<span class="attr">"diskSpace"</span>:&#123;<span class="attr">"status"</span>:<span class="string">"UP"</span>,<span class="attr">"details"</span>:&#123;<span class="attr">"total"</span>:<span class="number">250790436864</span>,<span class="attr">"free"</span>:<span class="number">27172782080</span>,<span class="attr">"threshold"</span>:<span class="number">10485760</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>health</code> endpoint现在包含了<code>DiskSpaceHealthIndicator</code>。</p>
<p>如果你的应用包含database(比如MySQL)，<code>health</code> endpoint将显示如下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">"status"</span>:<span class="string">"UP"</span>,</span><br><span class="line">   <span class="attr">"details"</span>:&#123;</span><br><span class="line">      <span class="attr">"db"</span>:&#123;</span><br><span class="line">         <span class="attr">"status"</span>:<span class="string">"UP"</span>,</span><br><span class="line">         <span class="attr">"details"</span>:&#123;</span><br><span class="line">            <span class="attr">"database"</span>:<span class="string">"MySQL"</span>,</span><br><span class="line">            <span class="attr">"hello"</span>:<span class="number">1</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"diskSpace"</span>:&#123;</span><br><span class="line">         <span class="attr">"status"</span>:<span class="string">"UP"</span>,</span><br><span class="line">         <span class="attr">"details"</span>:&#123;</span><br><span class="line">            <span class="attr">"total"</span>:<span class="number">250790436864</span>,</span><br><span class="line">            <span class="attr">"free"</span>:<span class="number">100330897408</span>,</span><br><span class="line">            <span class="attr">"threshold"</span>:<span class="number">10485760</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你的MySQL server没有启起来，状态将会变成<code>DOWN</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;status&quot;:&quot;DOWN&quot;,</span><br><span class="line">   &quot;details&quot;:&#123;</span><br><span class="line">      &quot;db&quot;:&#123;</span><br><span class="line">         &quot;status&quot;:&quot;DOWN&quot;,</span><br><span class="line">         &quot;details&quot;:&#123;</span><br><span class="line">            &quot;error&quot;:&quot;org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection; nested exception is java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30006ms.&quot;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;diskSpace&quot;:&#123;</span><br><span class="line">         &quot;status&quot;:&quot;UP&quot;,</span><br><span class="line">         &quot;details&quot;:&#123;</span><br><span class="line">            &quot;total&quot;:250790436864,</span><br><span class="line">            &quot;free&quot;:100324585472,</span><br><span class="line">            &quot;threshold&quot;:10485760</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="创建一个自定义的健康指标"><a href="#创建一个自定义的健康指标" class="headerlink" title="创建一个自定义的健康指标"></a>创建一个自定义的健康指标</h4><p>你可以通过实现<code>HealthIndicator</code>接口来自定义一个健康指标，或者继承<code>AbstractHealthIndicator</code>类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.example.actuator.health;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.actuate.health.AbstractHealthIndicator;</span><br><span class="line">import org.springframework.boot.actuate.health.Health;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class CustomHealthIndicator extends AbstractHealthIndicator &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doHealthCheck(Health.Builder builder) throws Exception &#123;</span><br><span class="line">        &#x2F;&#x2F; Use the builder to build the health status details that should be reported.</span><br><span class="line">        &#x2F;&#x2F; If you throw an exception, the status will be DOWN with the exception message.</span><br><span class="line">        </span><br><span class="line">        builder.up()</span><br><span class="line">                .withDetail(&quot;app&quot;, &quot;Alive and Kicking&quot;)</span><br><span class="line">                .withDetail(&quot;error&quot;, &quot;Nothing! I&#39;m good.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一旦你增加上面的健康指标到你的应用中去后，<code>health</code> endpoint将展示如下细节:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;status&quot;:&quot;UP&quot;,</span><br><span class="line">   &quot;details&quot;:&#123;</span><br><span class="line">      &quot;custom&quot;:&#123;</span><br><span class="line">         &quot;status&quot;:&quot;UP&quot;,</span><br><span class="line">         &quot;details&quot;:&#123;</span><br><span class="line">            &quot;app&quot;:&quot;Alive and Kicking&quot;,</span><br><span class="line">            &quot;error&quot;:&quot;Nothing! I&#39;m good.&quot;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;diskSpace&quot;:&#123;</span><br><span class="line">         &quot;status&quot;:&quot;UP&quot;,</span><br><span class="line">         &quot;details&quot;:&#123;</span><br><span class="line">            &quot;total&quot;:250790436864,</span><br><span class="line">            &quot;free&quot;:97949245440,</span><br><span class="line">            &quot;threshold&quot;:10485760</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="metrics-endpoint"><a href="#metrics-endpoint" class="headerlink" title="/metrics endpoint"></a>/metrics endpoint</h3><p><code>metrics</code> endpoint展示了你可以追踪的所有的度量。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"names"</span>: [</span><br><span class="line">		<span class="string">"jvm.memory.max"</span>,</span><br><span class="line">		<span class="string">"http.server.requests"</span>,</span><br><span class="line">		<span class="string">"process.files.max"</span>,</span><br><span class="line">		...</span><br><span class="line">		<span class="string">"tomcat.threads.busy"</span>,</span><br><span class="line">		<span class="string">"process.start.time"</span>,</span><br><span class="line">		<span class="string">"tomcat.servlet.error"</span></span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想要获得每个度量的详细信息，你需要传递度量的名称到URL中，像</p>
<p><a href="http://localhost:8080/actuator/metrics/%7BMetricName" target="_blank" rel="noopener">http://localhost:8080/actuator/metrics/{MetricName}</a></p>
<p>举个例子，获得<code>systems.cpu.usage</code>的详细信息，使用以下URL<a href="http://localhost:8080/actuator/metrics/system.cpu.usage" target="_blank" rel="noopener">http://localhost:8080/actuator/metrics/system.cpu.usage</a>。它将显示如下内容:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>: <span class="string">"system.cpu.usage"</span>,</span><br><span class="line">	<span class="attr">"measurements"</span>: [</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">"statistic"</span>: <span class="string">"VALUE"</span>,</span><br><span class="line">		<span class="attr">"value"</span>: <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">	],</span><br><span class="line"><span class="attr">"availableTags"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="loggers-endpoint"><a href="#loggers-endpoint" class="headerlink" title="/loggers endpoint"></a>/loggers endpoint</h3><p><code>loggers</code> endpoint，可以通过访问<a href="http://localhost:8080/actuator/loggers" target="_blank" rel="noopener">http://localhost:8080/actuator/loggers</a>来进入。它展示了应用中可配置的loggers的列表和相关的日志等级。</p>
<p>你同样能够使用<a href="http://localhost:8080/actuator/loggers/%7Bname" target="_blank" rel="noopener">http://localhost:8080/actuator/loggers/{name}</a>来展示特定logger的细节。</p>
<p>举个例子，为了获得<code>root</code> logger的细节，你可以使用<a href="http://localhost:8080/actuator/loggers/root" target="_blank" rel="noopener">http://localhost:8080/actuator/loggers/root</a>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;configuredLevel&quot;:&quot;INFO&quot;,</span><br><span class="line">   &quot;effectiveLevel&quot;:&quot;INFO&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="在运行时改变日志等级"><a href="#在运行时改变日志等级" class="headerlink" title="在运行时改变日志等级"></a>在运行时改变日志等级</h4><p><code>loggers</code> endpoint也允许你在运行时改变应用的日志等级。</p>
<p>举个例子，为了改变<code>root</code> logger的等级为<code>DEBUG</code> ，发送一个<code>POST</code>请求到<a href="http://localhost:8080/actuator/loggers/root" target="_blank" rel="noopener">http://localhost:8080/actuator/loggers/root</a>，加入如下参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;configuredLevel&quot;: &quot;DEBUG&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个功能对于线上问题的排查非常有用。</p>
<p>同时，你可以通过传递<code>null</code>值给<code>configuredLevel</code>来重置日志等级。</p>
<h3 id="info-endpoint"><a href="#info-endpoint" class="headerlink" title="/info endpoint"></a>/info endpoint</h3><p><code>info</code> endpoint展示了应用的基本信息。它通过<code>META-INF/build-info.properties</code>来获得编译信息，通过<code>git.properties</code>来获得Git信息。它同时可以展示任何其他信息，只要这个环境property中含有<code>info</code>key。</p>
<p>你可以增加properties到<code>application.yaml</code>中，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># INFO ENDPOINT CONFIGURATION</span><br><span class="line">info:</span><br><span class="line">  app:</span><br><span class="line">    name: @project.name@</span><br><span class="line">    description: @project.description@</span><br><span class="line">    version: @project.version@</span><br><span class="line">    encoding: @project.build.sourceEncoding@</span><br><span class="line">    java:</span><br><span class="line">      version: @java.version@</span><br></pre></td></tr></table></figure>

<p>注意，我使用了Spring Boot的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-properties-and-configuration.html#howto-automatic-expansion" target="_blank" rel="noopener">Automatic property expansion</a> 特征来扩展来自maven工程的properties。</p>
<p>一旦你增加上面的properties，<code>info</code> endpoint将展示如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;app&quot;: &#123;</span><br><span class="line">	&quot;name&quot;: &quot;actuator&quot;,</span><br><span class="line">	&quot;description&quot;: &quot;Demo project for Spring Boot&quot;,</span><br><span class="line">	&quot;version&quot;: &quot;0.0.1-SNAPSHOT&quot;,</span><br><span class="line">	&quot;encoding&quot;: &quot;UTF-8&quot;,</span><br><span class="line">	&quot;java&quot;: &#123;</span><br><span class="line">		&quot;version&quot;: &quot;1.8.0_161&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用Spring-Security来保证Actuator-Endpoints安全"><a href="#使用Spring-Security来保证Actuator-Endpoints安全" class="headerlink" title="使用Spring Security来保证Actuator Endpoints安全"></a>使用Spring Security来保证Actuator Endpoints安全</h2><p>Actuator endpoints是敏感的，必须保障进入是被授权的。如果Spring Security是包含在你的应用中，那么endpoint是通过HTTP认证被保护起来的。</p>
<p>如果没有， 你可以增加以下以来到你的应用中去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>接下去让我们看一下如何覆写spring security配置，并且定义你自己的进入规则。</p>
<p>下面的例子展示了一个简单的spring securiy配置。它使用叫做<a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/autoconfigure/security/servlet/EndpointRequest.html" target="_blank" rel="noopener"><code>EndPointRequest</code></a></p>
<p>的<code>ReqeustMatcher</code>工厂模式来配置Actuator endpoints进入规则。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">package com.example.actuator.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.actuate.autoconfigure.security.servlet.EndpointRequest;</span><br><span class="line">import org.springframework.boot.actuate.context.ShutdownEndpoint;</span><br><span class="line">import org.springframework.boot.autoconfigure.security.servlet.PathRequest;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class ActuatorSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;*</span><br><span class="line">        This spring security configuration does the following</span><br><span class="line"></span><br><span class="line">        1. Restrict access to the Shutdown endpoint to the ACTUATOR_ADMIN role.</span><br><span class="line">        2. Allow access to all other actuator endpoints.</span><br><span class="line">        3. Allow access to static resources.</span><br><span class="line">        4. Allow access to the home page (&#x2F;).</span><br><span class="line">        5. All other requests need to be authenticated.</span><br><span class="line">        5. Enable http basic authentication to make the configuration complete.</span><br><span class="line">           You are free to use any other form of authentication.</span><br><span class="line">     *&#x2F;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                    .requestMatchers(EndpointRequest.to(ShutdownEndpoint.class))</span><br><span class="line">                        .hasRole(&quot;ACTUATOR_ADMIN&quot;)</span><br><span class="line">                    .requestMatchers(EndpointRequest.toAnyEndpoint())</span><br><span class="line">                        .permitAll()</span><br><span class="line">                    .requestMatchers(PathRequest.toStaticResources().atCommonLocations())</span><br><span class="line">                        .permitAll()</span><br><span class="line">                    .antMatchers(&quot;&#x2F;&quot;)</span><br><span class="line">                        .permitAll()</span><br><span class="line">                    .antMatchers(&quot;&#x2F;**&quot;)</span><br><span class="line">                        .authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .httpBasic();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了能够测试以上的配置，你可以在<code>application.yaml</code>中增加spring security用户。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Spring Security Default user name and password</span><br><span class="line">spring:</span><br><span class="line">  security:</span><br><span class="line">    user:</span><br><span class="line">      name: actuator</span><br><span class="line">      password: actuator</span><br><span class="line">      roles: ACTUATOR_ADMIN</span><br></pre></td></tr></table></figure>

<p>你可以在<a href="https://github.com/bigjar/actuator-demo" target="_blank" rel="noopener">Github</a>上看到完整的代码。</p>
<p>下一部分：<a href="https://bigjar.github.io/2018/08/19/Spring-Boot-Metrics%E7%9B%91%E6%8E%A7%E4%B9%8BPrometheus-Grafana/" target="_blank" rel="noopener">Spring Boot Metrics监控之Prometheus&amp;Grafana</a></p>
<h2 id="更多学习资源"><a href="#更多学习资源" class="headerlink" title="更多学习资源"></a>更多学习资源</h2><ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready.html" target="_blank" rel="noopener">Spring Boot Actuator: Production-ready features</a></li>
<li><a href="https://spring.io/blog/2018/03/16/micrometer-spring-boot-2-s-new-application-metrics-collector" target="_blank" rel="noopener">Micrometer: Spring Boot 2’s new application metrics collector</a></li>
</ul>
<h2 id="翻译源"><a href="#翻译源" class="headerlink" title="翻译源"></a>翻译源</h2><ul>
<li><a href="https://www.callicoder.com/spring-boot-actuator/" target="_blank" rel="noopener">Spring Boot Actuator: Health check, Auditing, Metrics gathering and Monitoring</a></li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">MrHook</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://bigjar.github.io/2018/08/19/Spring-Boot-Actuator-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E3%80%81%E5%AE%A1%E8%AE%A1%E3%80%81%E7%BB%9F%E8%AE%A1%E5%92%8C%E7%9B%91%E6%8E%A7/">https://bigjar.github.io/2018/08/19/Spring-Boot-Actuator-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E3%80%81%E5%AE%A1%E8%AE%A1%E3%80%81%E7%BB%9F%E8%AE%A1%E5%92%8C%E7%9B%91%E6%8E%A7/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring-Boot/">Spring Boot</a><a class="post-meta__tags" href="/tags/Actuator/">Actuator</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/08/19/Spring-Boot-Metrics%E7%9B%91%E6%8E%A7%E4%B9%8BPrometheus-Grafana/"><i class="fa fa-chevron-left">  </i><span>Spring Boot Metrics监控之Prometheus&amp;Grafana</span></a></div><div class="next-post pull-right"><a href="/2018/08/12/Kafka%E4%B9%8BProducer%E6%BA%90%E7%A0%81/"><span>Kafka之Producer源码</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By MrHook</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>